{"id":"opencode-swarm-monorepo-lf2p4u-mjbpyqneyza","title":"swarm_complete fails with \"Review required\" then \"Bead not found\" for worker agents","description":"## Bug Summary\nWorker agents spawned via swarm cannot use `swarm_complete` to finish their tasks. Two sequential failures occur:\n\n## Reproduction Steps\n1. Spawn a worker agent with a cell ID (e.g., `opencode-swarm-monorepo-lf2p4u-mjbpknhiex2`)\n2. Complete the assigned work successfully\n3. Call `swarm_complete` with the cell ID\n\n## Observed Behavior\n\n**First attempt:**\n```\nswarm_complete(\n  project_key=\"/Users/joel/Code/joelhooks/opencode-swarm-plugin\",\n  agent_name=\"SwiftHawk\",\n  bead_id=\"opencode-swarm-monorepo-lf2p4u-mjbpknhiex2\",\n  summary=\"...\",\n  files_touched=[...]\n)\n```\n**Error:** `Review required before completion`\n\n**Second attempt with skip_review=true:**\n```\nswarm_complete(..., skip_review=true)\n```\n**Error:** `Bead not found: opencode-swarm-monorepo-lf2p4u-mjbpknhiex2`\n\n## Expected Behavior\nWorker agents should be able to complete their assigned cells. Either:\n1. The cell should exist (created by coordinator before spawning worker)\n2. Or `swarm_complete` should handle the case where cell doesn't exist gracefully\n\n## Root Cause Hypothesis\n1. **Cell not created:** Coordinator may not be creating cells before spawning workers, or cell IDs in handoff don't match actual hive cells\n2. **Review gate misconfigured:** The review requirement may be blocking completion even when skip_review is set\n3. **Bead lookup timing:** Cell might be created asynchronously and not yet visible\n\n## Workaround Used\nWorker released reservations manually via `swarmmail_release()` and sent completion notification via `swarmmail_send()` with `ack_required=true`.\n\n## Impact\n- Workers cannot properly close their cells\n- Learning signals not recorded (swarm_record_outcome not called)\n- UBS scan not run on completion\n- Coordinator must manually track completion via swarm mail\n\n## Related\n- Epic: opencode-swarm-monorepo-lf2p4u-mjbpknh125l (Worker Handoff Protocol)\n- Cell: opencode-swarm-monorepo-lf2p4u-mjbpknhiex2 (WorkerHandoff schema task)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:33:33.674Z","updated_at":"2025-12-18T17:54:04.985Z","closed_at":"2025-12-18T17:54:04.985Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbqozcp7u8","title":"hive_sync fails with \"unstaged changes\" - should handle gracefully","description":"## Bug Summary\n`hive_sync` frequently fails with:\n```\nFailed to pull: error: cannot pull with rebase: You have unstaged changes.\nerror: Please commit or stash them.\n```\n\n## Root Cause\n`hive_sync` tries to `git pull --rebase` before pushing, but this fails if there are uncommitted changes in the working directory.\n\n## Expected Behavior\n`hive_sync` should handle this gracefully:\n1. Stash changes before pull\n2. Pull with rebase\n3. Pop stash\n4. Push\n\nOr alternatively:\n- Skip pull if there are uncommitted changes and just push (with warning)\n- Or commit the .hive changes first, then pull/push\n\n## Current Workaround\nUser must manually commit or stash before calling `hive_sync`.\n\n## Proposed Fix\n```typescript\n// In hive_sync:\n// 1. Check for uncommitted changes\n// 2. If changes exist, stash them\n// 3. Pull --rebase\n// 4. Pop stash\n// 5. Push\n\n// Or simpler: just commit .hive/* changes first\nawait $`git add .hive/`;\nawait $`git commit -m \"chore: sync hive\" --allow-empty`.nothrow();\nawait $`git pull --rebase`;\nawait $`git push`;\n```\n\n## Impact\n- Breaks end-of-session workflow\n- Users forget to push hive changes\n- Cell state gets out of sync across machines","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:53:58.009Z","updated_at":"2025-12-18T18:05:14.341Z","closed_at":"2025-12-18T18:05:14.341Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbqs7xge52","title":"Consolidate external tools into plugin: semantic-memory, CASS, UBS","description":"## Proposal\nRoll these external dependencies into opencode-swarm-plugin with a **ZERO EXTERNAL DEPENDENCIES** goal (Ollama exception for embeddings):\n\n1. **semantic-memory** (https://github.com/joelhooks/semantic-memory)\n   - Currently: Separate MCP server with its own PGLite + pgvector\n   - Target: Embedded in swarm-mail, shared PGLite instance\n   - Removes: 1 MCP server dependency\n\n2. **CASS** (https://github.com/Dicklesworthstone/coding_agent_session_search)\n   - Currently: Separate CLI/MCP for searching agent session histories\n   - Target: Embedded search using our vector infrastructure\n   - Removes: 1 CLI/MCP dependency\n\n3. **UBS** (https://github.com/Dicklesworthstone/ultimate_bug_scanner)\n   - Currently: External CLI called via Bash in swarm_complete\n   - Target: Bundled ast-grep rules, direct library calls\n   - Removes: 1 CLI dependency\n\n## Zero Dependencies Target\nAfter consolidation, the only external runtime dependency should be:\n- **Ollama** (optional) - for embedding generation\n\nEverything else bundled:\n- PGLite (embedded Postgres)\n- pgvector (vector search)\n- ast-grep rules (bundled)\n- Session indexing (embedded)\n\n## Architecture Vision\n```\nopencode-swarm-plugin\n└── swarm-mail (single PGLite + pgvector instance)\n    ├── Event Store (existing)\n    ├── Hive Cells (existing)\n    ├── Agent Mail (existing)\n    ├── Semantic Memory (embedded - no MCP)\n    ├── Session Search (embedded - no CASS CLI)\n    └── Bug Scanner (embedded - no UBS CLI)\n```\n\n## Benefits\n- `bun add opencode-swarm-plugin` gets EVERYTHING\n- No MCP servers to configure/run\n- No CLI tools to install\n- Offline-first (works without network)\n- Single database instance (less memory)\n- Faster (no process spawning)\n\n## Implementation Phases\n\n### Phase 1: Semantic Memory\n- Port tables to swarm-mail schema\n- Ollama integration for embeddings\n- Migration path for existing memories\n- Remove semantic-memory MCP dependency\n\n### Phase 2: Session Search\n- Port CASS indexing logic\n- Unified search: memories + sessions + cells\n- Remove cass CLI dependency\n\n### Phase 3: Bug Scanner\n- Bundle ast-grep rules as data\n- Direct rule execution (no CLI spawn)\n- Remove ubs CLI dependency\n\n## Risks\n- Larger bundle size (~5-10MB for ast-grep rules?)\n- More maintenance surface\n- Need to track upstream UBS rule updates","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T17:56:29.092Z","updated_at":"2025-12-18T17:58:21.760Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr1bccgsj","title":"Update swarm worker prompt to mandate TDD by default","description":"## Problem\nCoordinator has to keep reminding workers \"tdd\" - it should be baked into the worker prompt.\n\n## Fix\nUpdate SUBTASK_PROMPT_V2 in swarm-prompts.ts to:\n1. Make TDD the default workflow (not optional)\n2. Add explicit RED → GREEN → REFACTOR steps\n3. Emphasize \"write failing test FIRST\" before any implementation\n\n## Current\nWorkers get a generic \"do the work\" instruction.\n\n## Target\nWorkers get explicit TDD mandate:\n```\n## [WORKFLOW - TDD MANDATORY]\n1. RED: Write a failing test that describes the expected behavior\n2. GREEN: Write minimal code to make the test pass\n3. REFACTOR: Clean up while tests stay green\n\n**No exceptions.** Write the test FIRST, then implement.\n```\n\n## Files\n- `packages/opencode-swarm-plugin/src/swarm-prompts.ts` - SUBTASK_PROMPT_V2","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T18:03:33.420Z","updated_at":"2025-12-18T18:05:13.162Z","closed_at":"2025-12-18T18:05:13.162Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywadv9","title":"Documentation refresh for v0.31","description":"Comprehensive docs update to reflect all recent changes:\n- beads → hive rename\n- bd CLI removal\n- Worker Handoff Protocol\n- TDD mandate in workers\n- New tools and features\n\nTarget: Clear, concise install instructions on homepage + accurate reference docs.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-18T18:06:23.914Z","updated_at":"2025-12-18T18:42:31.145Z","closed_at":"2025-12-18T18:42:31.145Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywmb5f","title":"Update homepage install section with current workflow","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T18:06:23.926Z","updated_at":"2025-12-18T18:41:54.853Z","closed_at":"2025-12-18T18:41:54.853Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywadv9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywqqrw","title":"Update quickstart.mdx - hive rename, remove bd CLI refs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T18:06:23.930Z","updated_at":"2025-12-18T18:41:20.327Z","closed_at":"2025-12-18T18:41:20.327Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywadv9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywuz16","title":"Rename beads.mdx to hive.mdx, update all tool names","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T18:06:23.934Z","updated_at":"2025-12-18T18:37:42.737Z","closed_at":"2025-12-18T18:37:42.737Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywadv9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywx7hh","title":"Update swarm.mdx with Worker Handoff Protocol, TDD mandate","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T18:06:23.937Z","updated_at":"2025-12-18T18:42:29.778Z","closed_at":"2025-12-18T18:42:29.778Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywadv9","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbr4yx1t2y","title":"Update index.mdx landing page","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T18:06:23.941Z","updated_at":"2025-12-18T18:41:13.753Z","closed_at":"2025-12-18T18:41:13.753Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbr4ywadv9","dependencies":[],"labels":[],"comments":[]}