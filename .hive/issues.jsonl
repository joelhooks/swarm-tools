{"id":"opencode-swarm-monorepo-lf2p4u-mjbpknh125l","title":"Worker Handoff Protocol - ADR + Implementation","description":"Implement structured worker handoff protocol to replace 400-line SUBTASK_PROMPT_V2 prose with machine-readable contracts. Workers receive explicit contract (files_owned, success_criteria) that swarm_complete validates. Enables automatic scope creep detection and smaller prompts.\n\nBased on research: mdflow adapter patterns, Bellemare event contracts, \"Patterns for Building AI Agents\" subagent handoff.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-18T17:22:36.373Z","updated_at":"2025-12-18T17:48:16.271Z","closed_at":"2025-12-18T17:48:16.271Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbpknhddzc","title":"ADR-008: Worker Handoff Protocol architecture","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T17:22:36.385Z","updated_at":"2025-12-18T17:48:08.676Z","closed_at":"2025-12-18T17:48:08.676Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbpknh125l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbpknhiex2","title":"WorkerHandoff schema and types with Zod validation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T17:22:36.390Z","updated_at":"2025-12-18T17:48:09.105Z","closed_at":"2025-12-18T17:48:09.105Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbpknh125l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbpknhltg1","title":"Handoff generation in swarm_spawn_subtask","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T17:22:36.393Z","updated_at":"2025-12-18T17:48:09.985Z","closed_at":"2025-12-18T17:48:09.985Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbpknh125l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbpknhotdy","title":"Contract validation in swarm_complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T17:22:36.396Z","updated_at":"2025-12-18T17:48:10.905Z","closed_at":"2025-12-18T17:48:10.905Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbpknh125l","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbpyqneyza","title":"swarm_complete fails with \"Review required\" then \"Bead not found\" for worker agents","description":"## Bug Summary\nWorker agents spawned via swarm cannot use `swarm_complete` to finish their tasks. Two sequential failures occur:\n\n## Reproduction Steps\n1. Spawn a worker agent with a cell ID (e.g., `opencode-swarm-monorepo-lf2p4u-mjbpknhiex2`)\n2. Complete the assigned work successfully\n3. Call `swarm_complete` with the cell ID\n\n## Observed Behavior\n\n**First attempt:**\n```\nswarm_complete(\n  project_key=\"/Users/joel/Code/joelhooks/opencode-swarm-plugin\",\n  agent_name=\"SwiftHawk\",\n  bead_id=\"opencode-swarm-monorepo-lf2p4u-mjbpknhiex2\",\n  summary=\"...\",\n  files_touched=[...]\n)\n```\n**Error:** `Review required before completion`\n\n**Second attempt with skip_review=true:**\n```\nswarm_complete(..., skip_review=true)\n```\n**Error:** `Bead not found: opencode-swarm-monorepo-lf2p4u-mjbpknhiex2`\n\n## Expected Behavior\nWorker agents should be able to complete their assigned cells. Either:\n1. The cell should exist (created by coordinator before spawning worker)\n2. Or `swarm_complete` should handle the case where cell doesn't exist gracefully\n\n## Root Cause Hypothesis\n1. **Cell not created:** Coordinator may not be creating cells before spawning workers, or cell IDs in handoff don't match actual hive cells\n2. **Review gate misconfigured:** The review requirement may be blocking completion even when skip_review is set\n3. **Bead lookup timing:** Cell might be created asynchronously and not yet visible\n\n## Workaround Used\nWorker released reservations manually via `swarmmail_release()` and sent completion notification via `swarmmail_send()` with `ack_required=true`.\n\n## Impact\n- Workers cannot properly close their cells\n- Learning signals not recorded (swarm_record_outcome not called)\n- UBS scan not run on completion\n- Coordinator must manually track completion via swarm mail\n\n## Related\n- Epic: opencode-swarm-monorepo-lf2p4u-mjbpknh125l (Worker Handoff Protocol)\n- Cell: opencode-swarm-monorepo-lf2p4u-mjbpknhiex2 (WorkerHandoff schema task)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:33:33.674Z","updated_at":"2025-12-18T17:33:33.674Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbq4yj98kt","title":"Add haiku-level \"lowfi\" worker for simple tasks","description":"## Context\nDuring Worker Handoff Protocol epic, noticed ADR writing task used Sonnet when Haiku would suffice. Cost optimization opportunity.\n\n## Proposal\nAdd model selection to swarm workers based on task complexity:\n\n**Selection logic (in priority order):**\n1. Explicit `model` field in subtask definition\n2. File-type inference: docs-only (.md) or test-only (.test.ts) → haiku\n3. Complexity estimate: 1-2 → haiku, 3-5 → sonnet\n\n**Good haiku candidates:**\n- ADR/docs writing (prose, no code execution)\n- Simple file edits (add export, rename, update import)\n- Schema-only tasks (Zod with clear spec)\n- Test scaffolding (boilerplate structure)\n- Changelog/commit messages\n\n**Keep sonnet for:**\n- Complex refactors (multi-file reasoning)\n- Bug investigation (deep codebase understanding)\n- Architecture decisions (tradeoff analysis)\n- Integration work (cross-cutting concerns)\n\n## Implementation\n1. Add optional `model` field to subtask schema in CellTree\n2. Add `selectWorkerModel()` function with inference logic\n3. Pass model to Task tool's subagent_type (need to check if opencode supports this)\n4. Track model usage in swarm_record_outcome for learning\n\n## References\n- Discovered during: opencode-swarm-monorepo-lf2p4u-mjbpknh125l (Worker Handoff Protocol epic)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T17:38:23.829Z","updated_at":"2025-12-18T17:38:23.829Z","dependencies":[],"labels":[],"comments":[]}